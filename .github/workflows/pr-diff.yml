- name: Set up Java
  uses: actions/setup-java@v4
  with:
    distribution: temurin
    java-version: '21'

- name: Build (shaded jar)
  run: mvn -q -DskipTests package

- name: Run PR diff collector
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    REPOSITORY: ${{ github.repository }}
    PR_NUMBER: ${{ github.event.pull_request.number }}
  run: java -jar target/*-shaded.jar

- name: Upload diff JSON
  uses: actions/upload-artifact@v4
  with:
    name: pr-diff
    path: out/pr_diff.json
